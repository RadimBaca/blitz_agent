{% extends "base.html" %}

{% block title %}Recommendation Analysis - {{ proc_name }}{% endblock %}

{% block content_header %}
<p><a href="{{ url_for('procedure', display_name=proc_name) }}">← Back</a></p>
<h2>Recommendation Chat: {{ proc_name }} - #{{ rec_id }}</h2>
{% endblock %}

{% block load_form %}
<!-- No load form needed for analyze page -->
{% endblock %}

{% block content %}

    <div class="chat-container">
        {% for role, message in chat_history %}
            {% if role == 'ai' %}
                <div class="chat-message ai">
                    <strong>AI:</strong>
                    {{ message | markdown }}
                </div>
            {% elif role == 'user' %}
                <div class="chat-message user">
                    <strong>You:</strong>
                    {{ message | markdown }}
                </div>
            {% endif %}
            <hr class="chat-separator">
        {% endfor %}
    </div>

    <form method="post" class="chat-input-form">
        <textarea name="user_input" rows="4" placeholder="Ask question..."></textarea><br>
        <button type="submit">Ask</button>
    </form>

    <p><a href="{{ url_for('procedure', display_name=proc_name) }}">← Back</a></p>
{% endblock %}
